//! Auto-generated Axum server from OpenAPI specification
//! Generated by openapi-to-axum
use axum::{
    routing::{get, post, put, delete},
    Router, Json, extract::Path, middleware,
};
use serde::{Deserialize, Serialize};
use std::net::SocketAddr;
use auth_service::{
    AuthService, AuthUser, user_auth_middleware, system_auth_middleware, require_roles,
};
#[derive(Debug, Deserialize, Serialize)]
pub struct UrgentTaskProperties {
    pub notificationsSent: Option<i32>,
    pub escalationLevel: i32,
    pub dueBy: String,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct UrgentTask {
    pub id: String,
    pub status: String,
    pub description: Option<String>,
    pub tags: Option<Vec<String>>,
    pub title: String,
    pub priority: Option<String>,
    pub assigneeId: Option<String>,
    pub createdAt: String,
    pub updatedAt: String,
    pub notificationsSent: Option<i32>,
    pub escalationLevel: i32,
    pub dueBy: String,
    pub escalatedAt: Option<String>,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct BaseTaskProperties {
    pub status: String,
    pub description: Option<String>,
    pub tags: Option<Vec<String>>,
    pub title: String,
    pub priority: Option<String>,
    pub assigneeId: Option<String>,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct UpdateTaskRequest {
    pub description: Option<String>,
    pub priority: Option<String>,
    pub assigneeId: Option<String>,
    pub status: Option<String>,
    pub tags: Option<Vec<String>>,
    pub title: Option<String>,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct Task {
    pub id: String,
    pub status: String,
    pub description: Option<String>,
    pub tags: Option<Vec<String>>,
    pub title: String,
    pub priority: Option<String>,
    pub assigneeId: Option<String>,
    pub createdAt: String,
    pub updatedAt: String,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct EntityId {
    pub id: String,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct CreateTaskRequest {
    pub status: String,
    pub description: Option<String>,
    pub tags: Option<Vec<String>>,
    pub title: String,
    pub priority: Option<String>,
    pub assigneeId: Option<String>,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct CreateUrgentTaskRequest {
    pub status: String,
    pub description: Option<String>,
    pub tags: Option<Vec<String>>,
    pub title: String,
    pub priority: Option<String>,
    pub assigneeId: Option<String>,
    pub notificationsSent: Option<i32>,
    pub escalationLevel: i32,
    pub dueBy: String,
}
#[derive(Debug, Deserialize, Serialize)]
pub struct Timestamps {
    pub createdAt: String,
    pub updatedAt: String,
}
async fn listTasks(auth_user: AuthUser) -> Json<Vec<Task>> {
    todo!("Implement {} {}", "get", "/tasks")
}
async fn createTask(
    auth_user: AuthUser,
    Json(payload): Json<CreateTaskRequest>,
) -> Json<Task> {
    todo!("Implement {} {}", "post", "/tasks")
}
async fn getTask(Path(taskId): Path<String>) -> Json<Task> {
    todo!("Implement {} {}", "get", "/tasks/{taskId}")
}
async fn updateTask(
    auth_user: AuthUser,
    Path(taskId): Path<String>,
    Json(payload): Json<UpdateTaskRequest>,
) -> Json<Task> {
    todo!("Implement {} {}", "put", "/tasks/{taskId}")
}
async fn deleteTask(
    auth_user: AuthUser,
    Path(taskId): Path<String>,
) -> Json<serde_json::Value> {
    todo!("Implement {} {}", "delete", "/tasks/{taskId}")
}
async fn listUrgentTasks() -> Json<Vec<UrgentTask>> {
    todo!("Implement {} {}", "get", "/urgent-tasks")
}
async fn createUrgentTask(
    auth_user: AuthUser,
    Json(payload): Json<CreateUrgentTaskRequest>,
) -> Json<UrgentTask> {
    todo!("Implement {} {}", "post", "/urgent-tasks")
}
/// Create the Axum router with all generated routes
pub fn create_app(auth_service: AuthService) -> Router {
    Router::new()
        .route(
            "/tasks",
            get(listTasks)
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        user_auth_middleware,
                    ),
                )
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        require_roles(vec!["user".to_string(), "admin".to_string()]),
                    ),
                ),
        )
        .route(
            "/tasks",
            post(createTask)
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        user_auth_middleware,
                    ),
                )
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        require_roles(vec!["admin".to_string()]),
                    ),
                ),
        )
        .route("/tasks/{taskId}", get(getTask))
        .route(
            "/tasks/{taskId}",
            put(updateTask)
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        user_auth_middleware,
                    ),
                )
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        require_roles(vec!["admin".to_string()]),
                    ),
                ),
        )
        .route(
            "/tasks/{taskId}",
            delete(deleteTask)
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        user_auth_middleware,
                    ),
                )
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        require_roles(
                            vec!["admin".to_string(), "superadmin".to_string()],
                        ),
                    ),
                ),
        )
        .route("/urgent-tasks", get(listUrgentTasks))
        .route(
            "/urgent-tasks",
            post(createUrgentTask)
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        user_auth_middleware,
                    ),
                )
                .layer(
                    middleware::from_fn_with_state(
                        auth_service.clone(),
                        require_roles(vec!["admin".to_string()]),
                    ),
                ),
        )
        .with_state(auth_service)
}
/// Start the server on the given address
pub async fn start_server(
    addr: SocketAddr,
    jwt_secret: &str,
) -> Result<(), Box<dyn std::error::Error>> {
    let auth_service = AuthService::new(jwt_secret.as_bytes());
    let app = create_app(auth_service);
    println!("ðŸš€ Server starting on {}", addr);
    axum::serve(tokio::net::TcpListener::bind(addr).await?, app)
        .await
        .map_err(|e| e.into())
}
